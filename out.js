(()=>{var q,h,F,re,S,M,O,se,E={},W=[],oe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function N(n,e){for(var t in e)n[t]=e[t];return n}function H(n){var e=n.parentNode;e&&e.removeChild(n)}function l(n,e,t){var o,r,s,c={};for(s in e)s=="key"?o=e[s]:s=="ref"?r=e[s]:c[s]=e[s];if(arguments.length>2&&(c.children=arguments.length>3?q.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(s in n.defaultProps)c[s]===void 0&&(c[s]=n.defaultProps[s]);return P(n,c,o,r,null)}function P(n,e,t,o,r){var s={type:n,props:e,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:r??++F};return r==null&&h.vnode!=null&&h.vnode(s),s}function A(n){return n.children}function k(n,e){this.props=n,this.context=e}function x(n,e){if(e==null)return n.__?x(n.__,n.__.__k.indexOf(n)+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?x(n):null}function B(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return B(n)}}function G(n){(!n.__d&&(n.__d=!0)&&S.push(n)&&!D.__r++||O!==h.debounceRendering)&&((O=h.debounceRendering)||M)(D)}function D(){for(var n;D.__r=S.length;)n=S.sort(function(e,t){return e.__v.__b-t.__v.__b}),S=[],n.some(function(e){var t,o,r,s,c,u;e.__d&&(c=(s=(t=e).__v).__e,(u=t.__P)&&(o=[],(r=N({},s)).__v=s.__v+1,R(u,s,r,t.__n,u.ownerSVGElement!==void 0,s.__h!=null?[c]:null,o,c??x(s),s.__h),X(o,s),s.__e!=c&&B(s)))})}function V(n,e,t,o,r,s,c,u,p,f){var i,m,_,a,d,w,y,g=o&&o.__k||W,v=g.length;for(t.__k=[],i=0;i<e.length;i++)if((a=t.__k[i]=(a=e[i])==null||typeof a=="boolean"?null:typeof a=="string"||typeof a=="number"||typeof a=="bigint"?P(null,a,null,null,a):Array.isArray(a)?P(A,{children:a},null,null,null):a.__b>0?P(a.type,a.props,a.key,null,a.__v):a)!=null){if(a.__=t,a.__b=t.__b+1,(_=g[i])===null||_&&a.key==_.key&&a.type===_.type)g[i]=void 0;else for(m=0;m<v;m++){if((_=g[m])&&a.key==_.key&&a.type===_.type){g[m]=void 0;break}_=null}R(n,a,_=_||E,r,s,c,u,p,f),d=a.__e,(m=a.ref)&&_.ref!=m&&(y||(y=[]),_.ref&&y.push(_.ref,null,a),y.push(m,a.__c||d,a)),d!=null?(w==null&&(w=d),typeof a.type=="function"&&a.__k===_.__k?a.__d=p=j(a,p,n):p=Y(n,a,_,g,d,p),typeof t.type=="function"&&(t.__d=p)):p&&_.__e==p&&p.parentNode!=n&&(p=x(_))}for(t.__e=w,i=v;i--;)g[i]!=null&&(typeof t.type=="function"&&g[i].__e!=null&&g[i].__e==t.__d&&(t.__d=x(o,i+1)),Z(g[i],g[i]));if(y)for(i=0;i<y.length;i++)J(y[i],y[++i],y[++i])}function j(n,e,t){for(var o,r=n.__k,s=0;r&&s<r.length;s++)(o=r[s])&&(o.__=n,e=typeof o.type=="function"?j(o,e,t):Y(t,o,o,r,o.__e,e));return e}function Y(n,e,t,o,r,s){var c,u,p;if(e.__d!==void 0)c=e.__d,e.__d=void 0;else if(t==null||r!=s||r.parentNode==null)e:if(s==null||s.parentNode!==n)n.appendChild(r),c=null;else{for(u=s,p=0;(u=u.nextSibling)&&p<o.length;p+=2)if(u==r)break e;n.insertBefore(r,s),c=s}return c!==void 0?c:r.nextSibling}function ie(n,e,t,o,r){var s;for(s in t)s==="children"||s==="key"||s in e||L(n,s,null,t[s],o);for(s in e)r&&typeof e[s]!="function"||s==="children"||s==="key"||s==="value"||s==="checked"||t[s]===e[s]||L(n,s,e[s],t[s],o)}function z(n,e,t){e[0]==="-"?n.setProperty(e,t):n[e]=t==null?"":typeof t!="number"||oe.test(e)?t:t+"px"}function L(n,e,t,o,r){var s;e:if(e==="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof o=="string"&&(n.style.cssText=o=""),o)for(e in o)t&&e in t||z(n.style,e,"");if(t)for(e in t)o&&t[e]===o[e]||z(n.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")s=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in n?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+s]=t,t?o||n.addEventListener(e,s?Q:K,s):n.removeEventListener(e,s?Q:K,s);else if(e!=="dangerouslySetInnerHTML"){if(r)e=e.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t!=null&&(t!==!1||e[0]==="a"&&e[1]==="r")?n.setAttribute(e,t):n.removeAttribute(e))}}function K(n){this.l[n.type+!1](h.event?h.event(n):n)}function Q(n){this.l[n.type+!0](h.event?h.event(n):n)}function R(n,e,t,o,r,s,c,u,p){var f,i,m,_,a,d,w,y,g,v,T,b=e.type;if(e.constructor!==void 0)return null;t.__h!=null&&(p=t.__h,u=e.__e=t.__e,e.__h=null,s=[u]),(f=h.__b)&&f(e);try{e:if(typeof b=="function"){if(y=e.props,g=(f=b.contextType)&&o[f.__c],v=f?g?g.props.value:f.__:o,t.__c?w=(i=e.__c=t.__c).__=i.__E:("prototype"in b&&b.prototype.render?e.__c=i=new b(y,v):(e.__c=i=new k(y,v),i.constructor=b,i.render=ae),g&&g.sub(i),i.props=y,i.state||(i.state={}),i.context=v,i.__n=o,m=i.__d=!0,i.__h=[]),i.__s==null&&(i.__s=i.state),b.getDerivedStateFromProps!=null&&(i.__s==i.state&&(i.__s=N({},i.__s)),N(i.__s,b.getDerivedStateFromProps(y,i.__s))),_=i.props,a=i.state,m)b.getDerivedStateFromProps==null&&i.componentWillMount!=null&&i.componentWillMount(),i.componentDidMount!=null&&i.__h.push(i.componentDidMount);else{if(b.getDerivedStateFromProps==null&&y!==_&&i.componentWillReceiveProps!=null&&i.componentWillReceiveProps(y,v),!i.__e&&i.shouldComponentUpdate!=null&&i.shouldComponentUpdate(y,i.__s,v)===!1||e.__v===t.__v){i.props=y,i.state=i.__s,e.__v!==t.__v&&(i.__d=!1),i.__v=e,e.__e=t.__e,e.__k=t.__k,e.__k.forEach(function(C){C&&(C.__=e)}),i.__h.length&&c.push(i);break e}i.componentWillUpdate!=null&&i.componentWillUpdate(y,i.__s,v),i.componentDidUpdate!=null&&i.__h.push(function(){i.componentDidUpdate(_,a,d)})}i.context=v,i.props=y,i.state=i.__s,(f=h.__r)&&f(e),i.__d=!1,i.__v=e,i.__P=n,f=i.render(i.props,i.state,i.context),i.state=i.__s,i.getChildContext!=null&&(o=N(N({},o),i.getChildContext())),m||i.getSnapshotBeforeUpdate==null||(d=i.getSnapshotBeforeUpdate(_,a)),T=f!=null&&f.type===A&&f.key==null?f.props.children:f,V(n,Array.isArray(T)?T:[T],e,t,o,r,s,c,u,p),i.base=e.__e,e.__h=null,i.__h.length&&c.push(i),w&&(i.__E=i.__=null),i.__e=!1}else s==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=le(t.__e,e,t,o,r,s,c,p);(f=h.diffed)&&f(e)}catch(C){e.__v=null,(p||s!=null)&&(e.__e=u,e.__h=!!p,s[s.indexOf(u)]=null),h.__e(C,e,t)}}function X(n,e){h.__c&&h.__c(e,n),n.some(function(t){try{n=t.__h,t.__h=[],n.some(function(o){o.call(t)})}catch(o){h.__e(o,t.__v)}})}function le(n,e,t,o,r,s,c,u){var p,f,i,m=t.props,_=e.props,a=e.type,d=0;if(a==="svg"&&(r=!0),s!=null){for(;d<s.length;d++)if((p=s[d])&&"setAttribute"in p==!!a&&(a?p.localName===a:p.nodeType===3)){n=p,s[d]=null;break}}if(n==null){if(a===null)return document.createTextNode(_);n=r?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a,_.is&&_),s=null,u=!1}if(a===null)m===_||u&&n.data===_||(n.data=_);else{if(s=s&&q.call(n.childNodes),f=(m=t.props||E).dangerouslySetInnerHTML,i=_.dangerouslySetInnerHTML,!u){if(s!=null)for(m={},d=0;d<n.attributes.length;d++)m[n.attributes[d].name]=n.attributes[d].value;(i||f)&&(i&&(f&&i.__html==f.__html||i.__html===n.innerHTML)||(n.innerHTML=i&&i.__html||""))}if(ie(n,_,m,r,u),i)e.__k=[];else if(d=e.props.children,V(n,Array.isArray(d)?d:[d],e,t,o,r&&a!=="foreignObject",s,c,s?s[0]:t.__k&&x(t,0),u),s!=null)for(d=s.length;d--;)s[d]!=null&&H(s[d]);u||("value"in _&&(d=_.value)!==void 0&&(d!==m.value||d!==n.value||a==="progress"&&!d)&&L(n,"value",d,m.value,!1),"checked"in _&&(d=_.checked)!==void 0&&d!==n.checked&&L(n,"checked",d,m.checked,!1))}return n}function J(n,e,t){try{typeof n=="function"?n(e):n.current=e}catch(o){h.__e(o,t)}}function Z(n,e,t){var o,r;if(h.unmount&&h.unmount(n),(o=n.ref)&&(o.current&&o.current!==n.__e||J(o,null,e)),(o=n.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(s){h.__e(s,e)}o.base=o.__P=null}if(o=n.__k)for(r=0;r<o.length;r++)o[r]&&Z(o[r],e,typeof n.type!="function");t||n.__e==null||H(n.__e),n.__e=n.__d=void 0}function ae(n,e,t){return this.constructor(n,t)}function U(n,e,t){var o,r,s;h.__&&h.__(n,e),r=(o=typeof t=="function")?null:t&&t.__k||e.__k,s=[],R(e,n=(!o&&t||e).__k=l(A,null,[n]),r||E,E,e.ownerSVGElement!==void 0,!o&&t?[t]:r?null:e.firstChild?q.call(e.childNodes):null,s,!o&&t?t:r?r.__e:e.firstChild,o),X(s,n)}q=W.slice,h={__e:function(n,e){for(var t,o,r;e=e.__;)if((t=e.__c)&&!t.__)try{if((o=t.constructor)&&o.getDerivedStateFromError!=null&&(t.setState(o.getDerivedStateFromError(n)),r=t.__d),t.componentDidCatch!=null&&(t.componentDidCatch(n),r=t.__d),r)return t.__E=t}catch(s){n=s}throw n}},F=0,re=function(n){return n!=null&&n.constructor===void 0},k.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=N({},this.state),typeof n=="function"&&(n=n(N({},t),this.props)),n&&N(t,n),n!=null&&this.__v&&(e&&this.__h.push(e),G(this))},k.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),G(this))},k.prototype.render=A,S=[],M=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,D.__r=0,se=0;function I(n){this.name="Error404",this.el=n}I.prototype=Error.prototype;var ce="https://salty-ocean-46227.herokuapp.com";function pe(n,e){return`https://${n}.fandom.com/wiki/${e}`}var ee=class extends k{constructor(e){super(e);this.state={showRows:!0}}render(){let e=this.props.aside;if(!e)return null;let t=this.props.parser,o=[];if(!!!e.querySelector("figure"))return null;let s=null,c=e.querySelector("h2");c&&(s=l("h2",null,t.text(c)));let u=t.imgsrc(e.querySelector("figure").querySelector("img").src);for(let p of e.querySelectorAll("div.pi-item"))if(p.children.length!==0)if(p.children.length===1)o.push(t.parseNode(p));else if(p.children.length===2){let f=t.parseNode(p.children[0]),i=t.parseNode(p.children[1]);o.push(l("tr",null,l("td",null,f),l("td",null,i)))}else o.push(t.parseNode(p));return l("aside",null,s,l("div",{style:{display:"flex",justifyContent:"center"}},l("img",{src:u})),l("div",{onClick:()=>{this.setState({showRows:!this.state.showRows})}},l("button",null,this.state.showRows?"Hide":"Show")),this.state.showRows?l("table",null,o):null)}},te=class{constructor(e,t){this.raw_text=e,this.wiki=t;let o=new DOMParser;this.html=o.parseFromString(e,"text/html"),this.buildingTable=!1}qs(e){return this.html.querySelector(e)}text(e){return e?e.innerText.trim():(console.error("unknown el"),"-")}title(){return this.text(this.qs(".page-header__title"))}imgsrc(e){return e.includes("/revision/")?e.split("/revision/")[0]:e}aside(){let t=this.qs("div.mw-parser-output").querySelector("aside");return l(ee,{aside:t,parser:this})}toc(){let e=this.qs("#toc");if(!e)return null;let t=[],o=(s,c)=>{for(let u of s.children){let p=u.children[0],f=this.text(p.querySelector(".toctext"));t.push(l("div",{style:{marginLeft:`${20*c}px`}},l("a",{href:`#${encodeURI(f)}`},this.text(p))));let i=u.querySelector("ul");i&&o(i,c+1)}},r=e.querySelector("ul");return r?(o(r,0),l("div",{className:"toc"},t)):l("div",{className:"toc"},this.parseNode(e))}stripSuffix(e,t){return e.endsWith(t)?e.slice(0,-t.length):e}styleFrom(e){let t=["text-align","background-color"],o={};for(let r of t)e.style[r]&&(o[r]=e.style[r]);return o}parseNode(e){let t=[],o={SMALL:"small",B:"b",I:"i",EM:"em",SPAN:"span",DD:"dd",THEAD:"thead",TBODY:"tbody",TR:"tr",CENTER:"center",FONT:"font",STRONG:"strong",ASIDE:"aside",SECTION:"section"};for(let r of e.childNodes){if(o[r.nodeName]){let s=`${o[r.nodeName]}`;t.push(l(s,null,this.parseNode(r)));continue}if(r.nodeName==="A"){let s=r.href;if(r.href.startsWith(window.location.origin)){let c=r.href.split("/wiki/")[1];s=`${window.location.origin}/${this.wiki}/${c}`}t.push(l("a",{href:s},this.parseNode(r)))}else if(r.nodeName==="#text"){let s=r.textContent.trim()==="";(!s||s&&!this.buildingTable)&&t.push(l("span",null,r.textContent))}else if(r.nodeName==="P")r.innerText.trim()!==""&&t.push(l("p",null,this.parseNode(r)));else if(r.nodeName!=="SUP")if(r.nodeName==="BR")t.push(l("br",null));else if(r.nodeName==="DL")t.push(this.blockquoteFromDl(r));else if(r.nodeName==="H2"){let s=this.stripSuffix(this.text(r),"[]");t.push(l("h2",{id:encodeURI(s)},s))}else if(r.nodeName==="H3"){let s=this.stripSuffix(this.text(r),"[]");t.push(l("h3",{id:encodeURI(s)},s))}else if(r.nodeName==="H4"){let s=this.stripSuffix(this.text(r),"[]");t.push(l("h4",{id:encodeURI(s)},s))}else if(r.nodeName==="BLOCKQUOTE"){let s=r.querySelector("i"),c=null;if(s){c=this.parseNode(s);let u=r.querySelector("cite"),p=null;u&&(p=l("cite",null,l("small",null,this.parseNode(u)))),t.push(l("blockquote",null,c,p))}else t.push(l("blockquote",null,this.parseNode(r)))}else if(r.nodeName==="DIV"){let s=r.querySelector("dl");if(s)t.push(this.blockquoteFromDl(s));else if(r.id==="ma-article-type")t.push(l("p",{className:"article-type"},this.parseNode(r)));else{let c=this.styleFrom(r),u=null;r.classList.contains("year")&&(c.border="1px solid black",this.buildingTable=!0),r.classList.contains("wikia-gallery")&&(u="gallery"),t.push(l("p",{className:u,style:c},this.parseNode(r))),r.className==="year"&&(this.buildingTable=!1)}}else if(r.nodeName==="FIGURE"){let s=r.querySelector("a").href.split("/revision/")[0],c=this.text(r.querySelector("figcaption"));t.push(l("figure",null,l("img",{src:s}),l("figcaption",null,l("span",null,c))))}else if(r.nodeName==="UL")t.push(this.parseList(r,"ul"));else if(r.nodeName==="OL")t.push(this.parseList(r,"ol"));else if(r.nodeName==="IMG"){let s=r.getAttribute("data-src"),c=r.src;s&&(c=r.getAttribute("data-src")),t.push(l("img",{src:this.imgsrc(c)}))}else r.nodeName==="TD"?t.push(this.parseTableCell(r,"td")):r.nodeName==="TH"?t.push(this.parseTableCell(r,"th")):r.nodeName==="TABLE"?(this.buildingTable=!0,t.push(l("table",null,this.parseNode(r))),this.buildingTable=!1):r.nodeName==="NOSCRIPT"||(console.log("Unknown node:",r.nodeName),t.push(l("span",null,r.innerText)))}return t}parseTableCell(e,t){return l(t,{style:{background:e.style.background},rowspan:e.getAttribute("rowspan"),colspan:e.getAttribute("colspan")},this.parseNode(e))}parseList(e,t){let o=t,r=[];for(let s of e.querySelectorAll("li"))r.push(l("li",null,this.parseNode(s)));return l(o,null,r)}blockquoteFromDl(e){let t=[],o=null;if(e.children.length===1){let r=this.parseNode(e.children[0]);t.push(r)}else if(e.children.length===2){let r=this.parseNode(e.children[0]);t.push(r),t.push(l("cite",null,this.parseNode(e.children[1])))}else o="quote-many",t.push(this.parseNode(e));return l("blockquote",{className:o},t)}sections(){let e=this.qs("div.mw-parser-output"),t=!1,o=[];e.querySelector("#toc")||(t=!0);let r=[];for(let s of e.childNodes)s.nodeName!=="ASIDE"&&(t&&r.push(s),s.id==="toc"&&(t=!0));return l("div",{className:"sections"},this.parseNode({childNodes:r}))}headParagraphs(){let e=this.qs("div.mw-parser-output");if(!e.querySelector("#toc"))return null;let t=[];for(let r of Array.from(e.childNodes)){if(r.id==="toc")break;r.nodeName==="ASIDE"||r.nodeName==="DIV"&&r.querySelector("aside")||(r.nodeName!=="DL",t.push(r))}let o=this.parseNode({childNodes:t});return l("div",null,o)}},$=class extends k{constructor(e){super(e)}componentDidMount(){this.update()}async update(){let e=pe(this.props.wiki,this.props.page),t=await fetch(`${ce}/${e}`),o=await t.text();this.setState({error:t.status<200||t.status>=300,parser:new te(o,this.props.wiki),origin:e})}render(){if(!this.state.parser)return null;if(this.state.error)throw new I(l("div",null,this.props.page," not found on ",this.props.wiki));return this.props.onTitle(this.state.parser.title()),setTimeout(()=>{this.props.onLoad()},0),l("div",null,l("a",{href:this.state.origin},"origin"),l("h1",null,this.state.parser.title()),l("p",null,this.state.parser.aside()),l("p",null,this.state.parser.headParagraphs()),l("p",null,this.state.parser.toc()),l("p",null,this.state.parser.sections()))}};var ne=class extends k{componentDidCatch(e){console.error(e),this.setState({error:e})}render(){if(this.state.error){let e=""+this.state.error.stack;return this.state.error.el&&(e=this.state.error.el),l("div",{style:{fontFamily:"monospace"}},"Error fetching ",l("span",null,this.props.page)," from"," ",l("span",null,this.props.wiki),l("pre",{style:{color:"red"}},e))}return l($,{...this.props})}};async function _e(){let n=new URL(window.location.href),e=n.searchParams.get("p"),t=null,o=null;if(e){let r=e.split("/");if(r=r.map(s=>s.trim()).filter(s=>s!=""),r.length!=2){alert(`Expected to parts to the path: <wiki>/<page>, instead found ${r}`);return}[t,o]=r}else if(n.pathname.startsWith("https://"))o=n.pathname.split("/").slice(-1)[0],t=n.pathname.split("https://")[1].split(".")[0];else if(n.pathname.split("/").length===3){let r=n.pathname.split("/");t=r[1],o=r[2]}else{let r=`${n.origin}/lotr/Melkor`;U(l("div",null,"Unknown URL, can't determine wiki/page: ",n.href,l("p",null,"need something like ",l("a",{href:r},r))),document.body);return}U(l("div",null,"Loading '",o,"' from '",t,"'"),document.body),U(l(ne,{onTitle:r=>{document.title=r},onLoad:()=>{sessionStorage[o]&&window.scrollTo(0,sessionStorage[o])},wiki:t,page:o}),document.body),window.onscroll=()=>{sessionStorage[o]=window.scrollY}}_e();})();
